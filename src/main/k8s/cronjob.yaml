apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: spring-cloud-task-cronjob
spec:
  schedule: "*/1 * * * *"
  suspend: true
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: spring-cloud-task-as-k8s-cronjob
            image: 'rawsanj/spring-cloud-task-as-k8s-cronjob:0.1.2'
            envFrom:
            - configMapRef:
                name: spring-cloud-task-cronjob-config
            args:
            - /bin/sh
            - -c
            - echo 'Starting Spring Batch Task' && java -jar app.jar
          restartPolicy: OnFailure
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: spring-cloud-task-cronjob-config
data:
  MYSQL_DB_HOST: 'mysql-service'
  MYSQL_DB_PORT: '3306'
  MYSQL_DATABASE: 'spring-batch-db'
  DATABASE_USERNAME: 'cronJobUser'
  DATABASE_PASSWORD: 'SuperSecretMysqlPwd'
  SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT: 'org.hibernate.dialect.MySQL5Dialect'
  API_URL: 'https://bitpay.com/api/rates'
  SPRING_MAIL_USERNAME: ''
  SPRING_MAIL_PASSWORD: ''
